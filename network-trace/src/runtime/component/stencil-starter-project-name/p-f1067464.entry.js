import{r as t,c as i,h as s,g as e}from"./p-551d452f.js";import{f as o,g as a}from"./p-f450c62e.js";import{n as h,C as l,p as n,c as r}from"./p-e69246e8.js";import c from"color";import{D as d,T as p,a as u,C as m,H as f,b as g,R as x}from"./p-dfefde60.js";import{throttle as v}from"lodash-es";const b=h(d.hex()),w=class{constructor(e){t(this,e),this.calciteColorChange=i(this,"calciteColorChange",7),this.appearance="default",this.color=d,this.hideHex=!1,this.hideChannels=!1,this.hideSaved=!1,this.intlB=p.b,this.intlBlue=p.blue,this.intlDeleteColor=p.deleteColor,this.intlG=p.g,this.intlGreen=p.green,this.intlH=p.h,this.intlHsv=p.hsv,this.intlHex=p.hex,this.intlHue=p.hue,this.intlR=p.r,this.intlRed=p.red,this.intlRgb=p.rgb,this.intlS=p.s,this.intlSaturation=p.saturation,this.intlSaveColor=p.saveColor,this.intlSaved=p.saved,this.intlV=p.v,this.intlValue=p.value,this.scale="m",this.theme="light",this.value=b,this.colorUpdateLocked=!1,this.hueThumbState="idle",this.mode=l.HEX,this.sliderThumbState="idle",this.colorFieldAndSliderInteractive=!1,this.channelMode="rgb",this.channels=this.toChannels(d),this.dimensions=u.m,this.savedColors=[],this.handleTabActivate=t=>{this.channelMode=t.currentTarget.getAttribute("data-color-mode"),this.updateChannelsFromColor(this.color)},this.handleHexInputChange=t=>{t.stopPropagation();const{color:i}=this,s=t.target.value;s!==h(i.hex())&&this.internalColorSet(c(s))},this.handleSavedColorSelect=t=>{this.internalColorSet(c(t.currentTarget.color))},this.handleChannelInput=t=>{const i=t.target,s=Number(i.getAttribute("data-channel-index")),e="rgb"===this.channelMode?x[Object.keys(x)[s]]:f[Object.keys(f)[s]],o=Math.max(0,Math.min(Number(i.value),e));i.value=""+o},this.handleChannelChange=t=>{const i=t.target,s=Number(i.getAttribute("data-channel-index")),e=[...this.channels];e[s]=Number(i.value),this.updateColorFromChannels(e)},this.handleSavedColorKeyDown=t=>{" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),t.stopPropagation(),this.handleSavedColorSelect(t))},this.handleColorFieldAndSliderMouseLeave=()=>{this.colorFieldAndSliderInteractive=!1},this.handleColorFieldAndSliderMouseEnterOrMove=({offsetY:t})=>{const{dimensions:{colorField:{height:i},slider:{height:s}}}=this;this.colorFieldAndSliderInteractive=t<=i+s},this.renderChannelsTabTitle=t=>{const{channelMode:i,intlRgb:e,intlHsv:o}=this;return s("calcite-tab-title",{active:t===i,class:m.colorMode,"data-color-mode":t,onCalciteTabsActivate:this.handleTabActivate},"rgb"===t?e:o)},this.renderChannelsTab=t=>{const{channelMode:i,channels:e,intlB:o,intlBlue:a,intlG:h,intlGreen:l,intlH:n,intlHue:r,intlR:c,intlRed:d,intlS:p,intlSaturation:u,intlV:f,intlValue:g}=this,x="rgb"===t,v=x?[c,h,o]:[n,p,f],b=x?[d,l,a]:[r,u,g];return s("calcite-tab",{active:t===i,class:m.control},s("div",{class:m.channels},e.map(((t,i)=>this.renderChannel(t,i,v[i],b[i])))))},this.renderChannel=(t,i,e,o)=>s("calcite-input",{"aria-label":o,class:m.channel,"data-channel-index":i,numberButtonType:"none",onChange:this.handleChannelChange,onInput:this.handleChannelInput,prefixText:e,scale:"s",type:"number",value:t.toString()}),this.deleteColor=()=>{const t=this.color.hex();if(!(this.savedColors.indexOf(t)>-1))return;const i=this.savedColors.filter((i=>i!==t));this.savedColors=i,this.storageId&&localStorage.setItem(`${g}${this.storageId}`,JSON.stringify(i))},this.saveColor=()=>{const t=this.color.hex();if(this.savedColors.indexOf(t)>-1)return;const i=[...this.savedColors,t];this.savedColors=i,this.storageId&&localStorage.setItem(`${g}${this.storageId}`,JSON.stringify(i))},this.drawColorFieldAndSlider=v((()=>{this.fieldAndSliderRenderingContext&&(this.drawColorField(),this.drawHueSlider())}),16),this.initColorFieldAndSlider=t=>{this.fieldAndSliderRenderingContext=t.getContext("2d"),this.setCanvasContextSize(t,{width:this.dimensions.colorField.width,height:this.dimensions.colorField.height+this.dimensions.slider.height+2*this.getSliderCapSpacing()}),this.drawColorFieldAndSlider();const i=t=>{const{dimensions:{colorField:{height:i},slider:{height:s}}}=this;return t<=i?"color-field":t<=i+s?"slider":"none"},s=(t,i)=>{const{dimensions:{colorField:{height:s,width:e}}}=this,o=Math.round(f.s/e*t),a=Math.round(f.v/s*(s-i));this.internalColorSet(this.color.hsv().saturationv(o).value(a))};t.addEventListener("mousedown",(({offsetX:t,offsetY:o})=>{const a=i(o);"color-field"===a?(this.hueThumbState="drag",s(t,o)):"slider"===a&&(this.sliderThumbState="drag",e(t))})),t.addEventListener("mouseout",(()=>{this.hueThumbState="idle",this.sliderThumbState="idle",this.drawColorFieldAndSlider()})),t.addEventListener("mouseup",(()=>{this.hueThumbState="hover",this.sliderThumbState="hover",this.drawColorFieldAndSlider()})),t.addEventListener("mousemove",(({offsetX:t,offsetY:o})=>{const a=i(o);if("color-field"===a){const i=this.hueThumbState,e=this.color.hsv(),{dimensions:{colorField:{height:a,width:h},thumb:{radius:l}}}=this,n=Math.round(e.saturationv()/(f.s/h)),r=Math.round(a-e.value()/(f.v/a)),c=this.containsPoint(t,o,n,r,l);let d=!1;if("idle"===i&&c?(this.hueThumbState="hover",d=!0):"hover"!==i||c||(this.hueThumbState="idle",d=!0),"drag"!==this.hueThumbState)return void(d&&this.drawColorFieldAndSlider());s(t,o)}else if("slider"===a){const{dimensions:{slider:{height:i,width:s},thumb:{radius:a}}}=this,h=this.sliderThumbState,l=this.color.hsv().saturationv(100).value(100),n=Math.round(l.hue()/(360/s)),r=Math.round((i+this.getSliderCapSpacing())/2),c=this.containsPoint(t,o,n,r,a);let d=!1;if("idle"===h&&c?(this.sliderThumbState="hover",d=!0):"hover"!==h||c||(this.sliderThumbState="idle",d=!0),"drag"!==this.sliderThumbState)return void(d&&this.drawColorFieldAndSlider());e(t)}}));const e=t=>{const{dimensions:{slider:{width:i}}}=this;this.internalColorSet(this.color.hue(360/i*t))}}}handleColorChange(t){if(this.drawColorFieldAndSlider(),this.updateChannelsFromColor(t),this.colorUpdateLocked)return;const i=this.toValue(t);this.value=i}handleScaleChange(t="m"){this.updateDimensions(t)}handleValueChange(t,i){const s=n(t);if(!s)return console.warn("ignoring invalid color value: "+t),void(this.value=i);const e=this.mode!==s;if(this.mode=s,this.colorUpdateLocked)return void this.calciteColorChange.emit();const o=c(t),a=!r(o,this.color);(e||a)&&(this.color=o,this.calciteColorChange.emit())}async setFocus(){o(this.hexInputNode)}componentWillLoad(){const t=`${g}${this.storageId}`;this.storageId&&localStorage.getItem(t)&&(this.savedColors=JSON.parse(localStorage.getItem(t))),this.handleValueChange(this.value,b),this.updateDimensions(this.scale)}render(){const{color:t,intlDeleteColor:i,el:e,hideHex:o,hideChannels:h,hideSaved:l,intlHex:n,intlSaved:r,intlSaveColor:c,savedColors:d,scale:p,theme:u}=this,f=t.hex(),g="s"!==p?"m":p,{colorFieldAndSliderInteractive:x}=this,v=a(e);return s("div",{class:m.container},s("canvas",{class:{[m.colorFieldAndSlider]:!0,[m.colorFieldAndSliderInteractive]:x},onMouseEnter:this.handleColorFieldAndSliderMouseEnterOrMove,onMouseLeave:this.handleColorFieldAndSliderMouseLeave,onMouseMove:this.handleColorFieldAndSliderMouseEnterOrMove,ref:this.initColorFieldAndSlider}),o&&h?null:s("div",{class:{[m.controlSection]:!0,[m.section]:!0}},o?null:s("div",{class:m.hexOptions},s("span",{class:{[m.header]:!0,[m.headerHex]:!0,[m.underlinedHeader]:!0}},n),s("calcite-color-hex-input",{class:m.control,dir:v,onCalciteColorHexInputChange:this.handleHexInputChange,ref:t=>this.hexInputNode=t,scale:g,theme:u,value:f})),h?null:s("calcite-tabs",{class:{[m.colorModeContainer]:!0,[m.splitSection]:!0},dir:v},s("calcite-tab-nav",{slot:"tab-nav"},this.renderChannelsTabTitle("rgb"),this.renderChannelsTabTitle("hsv")),this.renderChannelsTab("rgb"),this.renderChannelsTab("hsv"))),l?null:s("div",{class:{[m.savedColorsSection]:!0,[m.section]:!0}},s("div",{class:m.header},s("label",null,r),s("div",{class:m.savedColorsButtons},s("calcite-button",{appearance:"transparent","aria-label":i,class:m.deleteColor,color:"dark",iconStart:"minus",onClick:this.deleteColor,scale:p,theme:u}),s("calcite-button",{appearance:"transparent","aria-label":c,class:m.saveColor,color:"dark",iconStart:"plus",onClick:this.saveColor,scale:p,theme:u}))),d.length>0?s("div",{class:m.savedColors},[...d.map((t=>s("calcite-color-swatch",{active:f===t,class:m.savedColor,color:t,key:t,onClick:this.handleSavedColorSelect,onKeyDown:this.handleSavedColorKeyDown,scale:p,tabIndex:0,theme:u})))]):null))}internalColorSet(t){r(t,this.color)||(this.colorUpdateLocked=!0,this.color=t,this.value=this.toValue(t),this.colorUpdateLocked=!1)}toValue(t){const{mode:i}=this;if(i.includes("hex"))return h(t.hex());if(i.includes("-css"))return t[i.replace("-css","").replace("a","")]().string();const s=t[i]().round().object();return i.endsWith("a")&&(s.a=s.alpha,delete s.alpha),s}getSliderCapSpacing(){const{dimensions:{slider:{height:t},thumb:{radius:i}}}=this;return 2*i-t}updateDimensions(t="m"){this.dimensions=u[t]}drawColorField(){const t=this.fieldAndSliderRenderingContext,{dimensions:{colorField:{height:i,width:s}}}=this;t.fillStyle=this.color.hsv().saturationv(100).value(100).string(),t.fillRect(0,0,s,i);const e=t.createLinearGradient(0,0,s,0);e.addColorStop(0,"rgba(255,255,255,1)"),e.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=e,t.fillRect(0,0,s,i);const o=t.createLinearGradient(0,0,0,i);o.addColorStop(0,"rgba(0,0,0,0)"),o.addColorStop(1,"rgba(0,0,0,1)"),t.fillStyle=o,t.fillRect(0,0,s,i),this.drawActiveColorFieldColor()}setCanvasContextSize(t,{height:i,width:s}){const e=window.devicePixelRatio||1;t.width=s*e,t.height=i*e,t.style.height=i+"px",t.style.width=s+"px",t.getContext("2d").scale(e,e)}containsPoint(t,i,s,e,o){return Math.pow(t-s,2)+Math.pow(i-e,2)<=Math.pow(o,2)}drawActiveColorFieldColor(){const t=this.color.hsv(),{dimensions:{colorField:{height:i,width:s},thumb:{radius:e}}}=this,o=t.saturationv()/(f.s/s),a=i-t.value()/(f.v/i);this.drawThumb(this.fieldAndSliderRenderingContext,e,o,a,t,this.hueThumbState)}drawThumb(t,i,s,e,o,a){const h=2*Math.PI;t.beginPath(),t.arc(s,e,i,0,h),t.shadowBlur="hover"===a?32:16,t.shadowColor=`rgba(0, 0, 0, ${"drag"===a?.32:.16})`,t.fillStyle="#fff",t.fill(),t.beginPath(),t.arc(s,e,i-3,0,h),t.shadowBlur=0,t.shadowColor="transparent",t.fillStyle=o.rgb().string(),t.fill()}drawActiveHueSliderColor(){const t=this.color.hsv().saturationv(100).value(100),{dimensions:{colorField:{height:i},slider:{height:s,width:e},thumb:{radius:o}}}=this,a=t.hue()/(360/e);this.drawThumb(this.fieldAndSliderRenderingContext,o,a,s/2+i,t,this.sliderThumbState)}drawHueSlider(){const t=this.fieldAndSliderRenderingContext,{dimensions:{colorField:{height:i},slider:{height:s,width:e}}}=this,o=t.createLinearGradient(0,0,e,0),a=["red","yellow","lime","cyan","blue","magenta","red"],h=1/(a.length-1);let l=0;a.forEach((t=>{o.addColorStop(l,c(t).string()),l+=h})),t.fillStyle=o,t.clearRect(0,i,e,s+2*this.getSliderCapSpacing()),t.fillRect(0,i,e,s),this.drawActiveHueSliderColor()}updateColorFromChannels(t){this.internalColorSet(c(t,this.channelMode))}updateChannelsFromColor(t){this.channels=this.toChannels(t)}toChannels(t){const{channelMode:i}=this;return t[i]().array().map((t=>Math.floor(t)))}get el(){return e(this)}static get watchers(){return{color:["handleColorChange"],scale:["handleScaleChange"],value:["handleValueChange"]}}};w.style="@keyframes calcite-fade-in{0%{opacity:0}100%{opacity:1}}@keyframes calcite-fade-in-down{0%{opacity:0;transform:translate3D(0, -5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes calcite-fade-in-up{0%{opacity:0;transform:translate3D(0, 5px, 0)}100%{opacity:1;transform:translate3D(0, 0, 0)}}@keyframes calcite-fade-in-scale{0%{opacity:0;transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;transform:scale3D(1, 1, 1)}}:root{--calcite-popper-transition:150ms ease-in-out}:host([hidden]){display:none}:host([scale=s]) .container{width:156px}:host([scale=s]) .saved-colors{grid-template-columns:repeat(auto-fill, minmax(20px, 1fr))}:host([scale=s]) .channels{flex-direction:column}:host([scale=s]) .channel{width:100%;margin-bottom:4px}:host([scale=s]) .channel:last-child{margin-bottom:0}:host([scale=m]) .container{width:272px}:host([scale=l][dir=rtl]) .control-section>:nth-child(2){margin-left:0;margin-right:12px}:host([scale=l]) .container{width:420px}:host([scale=l]) .color-field-and-slider{margin-bottom:-20px}:host([scale=l]) .section{padding:0 16px 16px}:host([scale=l]) .section:first-of-type{padding-top:16px}:host([scale=l]) .saved-colors{grid-template-columns:repeat(auto-fill, minmax(28px, 1fr));grid-gap:12px;padding-top:16px}:host([scale=l]) .control-section{flex-wrap:nowrap}:host([scale=l]) .control-section>:nth-child(2){margin-left:12px}:host([scale=l]) .color-hex-options{flex-shrink:1}:host([scale=l]) .color-mode-container{flex-shrink:3}:host([appearance=minimal]) .container{border:none}.container{display:inline-block;border:1px solid var(--calcite-ui-border-1);background-color:var(--calcite-ui-foreground-1)}.color-field-and-slider{margin-bottom:-16px}.color-field-and-slider--interactive{cursor:pointer}.control-section{display:flex;flex-direction:row;flex-wrap:wrap}.section{padding:0 12px 12px}.section:first-of-type{padding-top:12px}.color-hex-options,.section--split{flex-grow:1}.header{display:flex;align-items:center;justify-content:space-between;color:var(--calcite-ui-text-3);font-weight:500;font-size:0.875rem;line-height:1.5}.header.header--underlined{border-bottom:1px solid var(--calcite-ui-border-1)}.header--hex{line-height:1.5;font-size:0.875rem;line-height:1.5;padding:12px 0 15px}.control{margin-top:8px}.channels{display:flex;justify-content:space-between}.channel{width:31%}.saved-colors{padding-top:12px;display:-ms-grid;display:grid;grid-template-columns:repeat(auto-fill, minmax(24px, 1fr));grid-gap:8px;width:100%}.saved-colors-buttons{display:flex}.saved-color{outline-offset:0;outline-color:transparent;transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out;cursor:pointer}.saved-color:focus{outline:2px solid var(--calcite-ui-blue-1);outline-offset:2px}.saved-color:hover{transition:outline-color 100ms ease-in-out;outline:2px solid var(--calcite-ui-border-2);outline-offset:2px}";export{w as calcite_color}